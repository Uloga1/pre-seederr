<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings - Pre-Seederr</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">Pre-Seederr</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link active" href="/settings">Settings</a>
            </div>
        </div>
    </nav>

    <div class="container pb-5" style="max-width: 800px;">
        {{ if .GlobalSuccess }}
            <div class="alert alert-success fw-bold">{{ .GlobalSuccess }}</div>
        {{ end }}

        <form id="settings-form" method="POST" action="/settings">
            
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white fw-bold">Prowlarr Settings</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Prowlarr URL</label>
                        <input type="text" class="form-control" name="prowlarr_url" value="{{ .Config.ProwlarrURL }}" placeholder="http://192.168.1.100:9696" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">API Key</label>
                        <input type="password" class="form-control" name="prowlarr_api_key" value="{{ .Config.ProwlarrAPIKey }}" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Size Tolerance (MB)</label>
                        <input type="number" step="0.1" class="form-control" name="size_tolerance_mb" value="{{ .Config.SizeToleranceMB }}" required>
                        <div class="form-text">How much size difference is allowed when searching for matches?</div>
                    </div>
                    
                    <button type="button" class="btn btn-outline-primary btn-sm" id="test-prowlarr-btn">Test Prowlarr Connection</button>
                </div>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white fw-bold">qBittorrent Settings</div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">qBittorrent URL</label>
                        <input type="text" class="form-control" name="qbit_url" value="{{ .Config.QbitURL }}" placeholder="http://192.168.1.100:8080" required>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">Username</label>
                            <input type="text" class="form-control" name="qbit_user" value="{{ .Config.QbitUser }}" required>
                        </div>
                        <div class="col-md-6 mt-3 mt-md-0">
                            <label class="form-label fw-bold">Password</label>
                            <input type="password" class="form-control" name="qbit_pass" value="{{ .Config.QbitPass }}" required>
                        </div>
                    </div>

                    <div class="mb-3 mt-4">
                        <label class="form-label fw-bold">Injection Tag</label>
                        <input type="text" class="form-control" name="qbit_tag" value="{{ .Config.QbitTag }}" placeholder="pre-seed">
                        <div class="form-text">This tag will automatically be added to injected torrents in qBittorrent.</div>
                    </div>
                    
                    <div class="form-check mb-4 mt-4">
                        <input class="form-check-input" type="checkbox" name="qbit_skip_checking" id="skipCheck" {{ if .Config.QbitSkipChecking }}checked{{ end }}>
                        <label class="form-check-label fw-bold" for="skipCheck">
                            Skip Hash Check on Injection (Tracker A)
                        </label>
                    </div>

                    <button type="button" class="btn btn-outline-success btn-sm" id="test-qbit-btn">Test qBittorrent Connection</button>
                </div>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-dark btn-lg">Save Settings</button>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('test-prowlarr-btn').addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.innerText;
            btn.innerText = 'Testing...';
            btn.disabled = true;

            const formData = new FormData(document.getElementById('settings-form'));
            
            try {
                const response = await fetch('/test-prowlarr', { method: 'POST', body: formData });
                if (response.ok) {
                    btn.innerText = '✅ Connection Successful';
                    btn.classList.replace('btn-outline-primary', 'btn-success');
                    btn.classList.add('text-white');
                } else {
                    btn.innerText = '❌ Connection Failed';
                    btn.classList.replace('btn-outline-primary', 'btn-danger');
                    btn.classList.add('text-white');
                }
            } catch (e) {
                btn.innerText = '❌ Network Error';
                btn.classList.replace('btn-outline-primary', 'btn-danger');
                btn.classList.add('text-white');
            }

            setTimeout(() => {
                btn.innerText = originalText;
                btn.className = 'btn btn-outline-primary btn-sm';
                btn.disabled = false;
            }, 3000);
        });

        document.getElementById('test-qbit-btn').addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.innerText;
            btn.innerText = 'Testing...';
            btn.disabled = true;

            const formData = new FormData(document.getElementById('settings-form'));
            
            try {
                const response = await fetch('/test-qbit', { method: 'POST', body: formData });
                if (response.ok) {
                    btn.innerText = '✅ Connection Successful';
                    btn.classList.replace('btn-outline-success', 'btn-success');
                    btn.classList.add('text-white');
                } else {
                    btn.innerText = '❌ Connection Failed';
                    btn.classList.replace('btn-outline-success', 'btn-danger');
                    btn.classList.add('text-white');
                }
            } catch (e) {
                btn.innerText = '❌ Network Error';
                btn.classList.replace('btn-outline-success', 'btn-danger');
                btn.classList.add('text-white');
            }

            setTimeout(() => {
                btn.innerText = originalText;
                btn.className = 'btn btn-outline-success btn-sm';
                btn.disabled = false;
            }, 3000);
        });
    </script>
</body>
</html>